@page "/useredit/{Id:int}"
@using ASM_NhomSugar_SD19311.Model
@inject HttpClient Http
@inject NavigationManager Nav
@using Microsoft.AspNetCore.Components.Forms

<h3 class="mb-4 text-xl font-bold">✏️ Sửa người dùng</h3>

@if (user == null)
{
    <p class="text-gray-500 italic">Đang tải dữ liệu...</p>
}
else
{
    <EditForm Model="@user" OnValidSubmit="HandleValidSubmit">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="mb-3">
            <label class="block font-medium">Tên đầy đủ</label>
            <InputText class="w-full rounded border px-3 py-2" @bind-Value="user.FullName" />
        </div>
        <div class="mb-3">
            <label class="block font-medium">Số điện thoại</label>
            <InputText class="w-full rounded border px-3 py-2" @bind-Value="user.Phone" />
        </div>
        <div class="mb-3">
            <label class="block font-medium">Địa chỉ</label>
            <InputText class="w-full rounded border px-3 py-2" @bind-Value="user.Address" />
        </div>
        <div class="mb-3">
            <label class="block font-medium">ID Tài khoản</label>
            <InputNumber class="w-full rounded border px-3 py-2" @bind-Value="user.AccountId" />
        </div>

        <div class="mt-4 flex space-x-3">
            <button type="submit" class="rounded bg-yellow-500 px-4 py-2 text-white hover:bg-yellow-600">Cập nhật</button>
            <button type="button" class="rounded bg-gray-400 px-4 py-2 text-white hover:bg-gray-500" @onclick="() => Nav.NavigateTo(" /user")">Hủy</button>
        </div>
    </EditForm>
}

@code {
    [Parameter] public int Id { get; set; }
    private Users user;

    protected override async Task OnInitializedAsync()
    {
        var response = await Http.GetAsync($"https://localhost:44366/api/user/{Id}");
        if (response.IsSuccessStatusCode)
        {
            user = await response.Content.ReadFromJsonAsync<Users>();
        }
        else
        {
            Console.WriteLine("Lỗi tải người dùng: " + await response.Content.ReadAsStringAsync());
        }
    }

    private async Task HandleValidSubmit()
    {
        var response = await Http.PutAsJsonAsync($"https://localhost:44366/api/user/{Id}", user);
        if (response.IsSuccessStatusCode)
        {
            Nav.NavigateTo("/user");
        }
        else
        {
            Console.WriteLine("Cập nhật thất bại: " + await response.Content.ReadAsStringAsync());
        }
    }
}
